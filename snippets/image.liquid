{%- comment -%}
  Renders a responsive image with optimized sizes and lazy loading.
  
  @param {Object} image - Image object to render
  @param {String} loading - Loading strategy: 'lazy' or 'eager' (default: 'lazy')
  @param {String} class - CSS classes to apply to the image (default: '')
  @param {Number} factor - Size factor for desktop viewport (default: 1)
  @param {Number} mobile_factor - Size factor for mobile viewport (default: 1)
  @param {String} fetch_priority - Fetch priority: 'auto', 'high', or 'low' (default: 'auto')
  @param {String} alt - Alt text for the image (default: image.alt)
  
  @example
    {%- render 'image', 
        image: product.featured_image,
        class: 'product-image',
        factor: 0.5,
        mobile_factor: 1,
        loading: 'eager' -%}
{%- endcomment -%}

{%- liquid
  assign loading = loading | default: 'lazy'
  assign class = class | default: blank
  assign factor = factor | default: 1
  assign mobile_factor = mobile_factor | default: 1
  assign fetch_priority = fetch_priority | default: 'auto'

  if factor == 1
    assign base = 100
  else
    assign base = 90
  endif

  assign alt = alt | default: image.alt | split: '|' | last | strip
  assign size = base | divided_by: factor
  assign mobile_size = base | minus: 5 | divided_by: mobile_factor
  assign widths = '100,150,200,250,300,350,400,450,500,550,600,650,700,750,800,850,900,950,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,2600,2700,2800,2900,3000'

  if size == mobile_size
    assign sizes = size | append: 'vw'
  else
    assign sizes = '(min-width: 1024px) ' | append: size | append: 'vw, ' | append: mobile_size | append: 'vw'
  endif

  echo image | image_url: width: image.width | image_tag: sizes: sizes, widths: widths, alt: alt, class: class, loading: loading, fetch_priority: fetch_priority
-%}
